services:
  # Backend Flask API
  - type: web
    name: nutrifuel-backend
    runtime: python
    env: python
    region: oregon
    plan: free
    buildCommand: |
      python --version
      pip install --upgrade pip
      pip install --prefer-binary --only-binary :all: -r requirements.txt
    startCommand: "gunicorn --bind 0.0.0.0:$PORT --workers 3 --timeout 120 fyp.BAckend.App:app"
    envVars:
      - key: PYTHON_VERSION
        value: "3.11.9"
      - key: FLASK_ENV
        value: production
      - key: PORT
        value: 5000
    disk:
      name: data-volume
      mountPath: /data
      sizeGB: 5

  # Frontend React App
  - type: web
    name: nutrifuel-frontend
    runtime: node
    nodeVersion: 18
    buildCommand: "cd fyp/frontend && npm install --legacy-peer-deps && npm run build"
    startCommand: "cd fyp/frontend && npx serve -s build -l $PORT"
    envVars:
      - key: REACT_APP_API_URL
        value: "https://nutrifuel-backend.onrender.com"
      - key: PORT
        value: 10000
